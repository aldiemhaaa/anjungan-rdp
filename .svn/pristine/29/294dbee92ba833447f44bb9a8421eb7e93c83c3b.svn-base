{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Anjungan Pendaftaran Mandiri - RSUP Dr. Mohammad Hoesin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Anjungan Pendaftaran Mandiri - RSUP Dr. Mohammad Hoesin" name="description" />
    <meta content="Anjungan Pendaftaran Mandiri - RSUP Dr. Mohammad Hoesin" name="author" />
    {% csrf_token %}
    <script>
    var csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    </script>
    <!-- App favicon -->
    <link rel="icon" type="image/png" href="{% static 'Amezia_v1.2.0/assets/images/rsmh-logo.png' %}">

    <!-- Sweet Alert -->
    <link href="{% static 'Amezia_v1.2.0/assets/plugins/sweetalert2/dist/sweetalert2.min.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'Amezia_v1.2.0/assets/plugins/select2/select2.min.css' %}" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">

    <!-- App css -->
    <link href="{% static 'Amezia_v1.2.0/assets/css/bootstrap.min.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'Amezia_v1.2.0/assets/css/icons.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'Amezia_v1.2.0/assets/css/style.css' %}" rel="stylesheet" type="text/css" />
    <style>
        main {
            height: 100%;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            /* Ensure that the height of the element includes the  box border, not just the content */
            border: 0;
            /* Leave some space for the header and footer to  overlay. */
            border-top: 20px solid white;
            border-bottom: 20px solid white;
        }

        .wrapper {
            padding-top: 140px;
        }

        #logo {
            vertical-align: middle;
        }

        .navbar-brand span {
            font-size: 1.3rem;
            line-height: 1.5;
            font-weight: 200;
            display: inline-block;
            vertical-align: middle;
            padding: 0 0 0 5px;
            color: #267146;
        }

        .navbar-brand b {
            display: block;
            font-size: 60%;
            line-height: 1;
        }

        .navbar-nav {
            margin-left: auto;
        }

        #footer {
            /* position:fixed; */
            /* left:0px;
        bottom:0px;           
        width:100%;           
        font-size: 20px; 
        background: #2cba44;
        padding: 10px;
        padding-top: 15px;
        line-height: 1.15em;
        color: #ffffff;    */
        }

        /* IE 6 */
        * html #footer {
            position: absolute;
            top: expression((0-(footer.offsetHeight)+(document.documentElement.clientHeight ? document.documentElement.clientHeight : document.body.clientHeight)+(ignoreMe=document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop))+'px');
        }

        .topbar .topbar-main {
            background-color: #f2f5f7;
        }

        .topbar .topbar-left {
            background-color: #f2f5f7;
        }

        .navbar-custom {
            background: #f2f5f7;
        }

        .fill {
            position: absolute;
            min-height: 100%;
            height: 100%;
            width: 100%;
            background-image: url("{% static 'Amezia_v1.2.0/assets/images/background.jpeg' %}");
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            padding-bottom: 40px;
            padding-top: 136px;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            color: #000;
            padding: 0;
        }

        #footer {
            position: absolute;
            bottom: 0;
            width: 100%;
            clear: both;
            height: 40px;
            font-size: 18px;
            background: #2cba44;
            color: #ffffff;
            padding: 10px;
            padding-top: 8px;
        }
        .container-fluid {
			width: 90%;
		}
		.border-left-primary {
			border-left: .25rem solid #4e73df!important;
		}
		.border-left-warning {
            border-left: .25rem solid #f6c23e!important;
        }
        .border-left-success {
            border-left: .25rem solid #1cc88a!important;
        }
		.col-auto {
			flex: 0 0 auto;
			width: auto;
			max-width: 100%;
		}
		.col {
            flex-basis: 0;
            flex-grow: 1;
            max-width: 100%;
        }
        .modal-content
        {
            border-radius: 6px;
            -webkit-border-radius: 6px;
            -moz-border-radius: 6px;
        }
        .modal-header-primary {
            color:#fff;
            background-color: #44a2d2;
            -webkit-border-top-left-radius: 6px;
            -webkit-border-top-right-radius: 6px;
            -moz-border-radius-topleft: 6px;
            -moz-border-radius-topright: 6px;
            border-top-left-radius: 6px;
            border-top-right-radius: 6px;
        }
        .modal-content {
            background-color: #44a2d2;
        }
        .modal-body, .modal-footer {
            background-color: #fff;
        }
        #swal2-title {
            font-size: 20px;
        }
        .btn-warning:hover {
            color: #ffffff;
        }
    </style>
</head>

<body>

    <!-- Top Bar Start -->
    <div class="topbar">
        <div class="topbar-main">
            <div class="container-fluid">
                <!-- LOGO -->
                <div class="topbar-left pt-2 text-left">
                    <a class="navbar-brand" href="{% url 'home' %}"> <img id="logo" alt="Logo" src="{% static 'Amezia_v1.2.0/assets/images/rsmh-logo.png' %}"
                            width="45" height="45"> <span>RSUP Dr.
                            Mohammad Hoesin<b>Jl. Jenderal Sudirman Km 3,5 Kode Pos 30126, Palembang</b></span> </a>
                </div>

                <!-- Navbar -->
                <nav class="navbar-custom">

                    <ul class="list-unstyled topbar-nav float-right mb-0">
                        <li>
                            <a class="nav-link waves-effect waves-light href=" javascript:void(0);" style="font-size: 15px;color: #2cba44;">
                                <i class="mdi mdi-calendar-clock"></i> Selasa, 24 Maret 2020 | 10:00:00
                            </a>
                        </li>

                        <li class="hidden-sm">
                            <a class="nav-link waves-effect waves-light" href="javascript:void(0);" id="btn-fullscreen"
                                style="color: #2cba44;">
                                <i class="mdi mdi-fullscreen nav-icon"></i>
                            </a>
                        </li>

                        <li class="menu-item">
                            <!-- Mobile menu toggle-->
                            <a class="navbar-toggle nav-link" id="mobileToggle">
                                <div class="lines">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </div>
                            </a>
                            <!-- End mobile menu toggle-->
                        </li>
                    </ul>
                </nav>
                <!-- end navbar-->
            </div>
            <div class="row">
                <div class="card text-white w-100 mb-0" style="background-color: #2cba44;">
                    <div class="card-body pt-2 pb-2">
                        <h3 class="text-center">PASIEN BPJS / KIS</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Top Bar End -->

    <!-- Page Content-->
    <!-- <div class="wrapper"> -->
    <!-- <div class="fill bg-success" id="container">
                <div class="container-fluid h-100">
                    <div class="row align-items-center h-100">
                        <div class="col-md-12 mx-auto">
                            <p>Pilih Rujukan Berdasarkan :</p>
                            <button class="btn btn-success btn-lg">No. Rujukan</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="footer">
                <marquee>
                    RSUP Dr. Mohammad Hoesin "Kesembuhan dan Kepuasan Anda Merupakan Kebahagiaan Kami"
                </marquee>
            </div> -->


    <div class="fill bg-success">
        <div class="container-fluid h-100">
            <div class="row align-items-center h-100">
                <div class="col-md-12 mx-auto">
                    <div class="row">
						<div class="col-xl-5 col-md-6 mx-auto pr-0">
						  <div class="card shadow text-white bg-info">
							<div class="card-body">
							  <div class="row no-gutters align-items-center">
								<div class="col">
									<div class="h5 font-weight-bold text-uppercase mb-2">RUJUKAN BARU</div>
									<div class="p mb-0 font-13">UNTUK PASIEN RUJUKAN DARI DOKTER/KLINIK/PUSKESMAS</div>
								  </div>
							  </div>
							</div>
							<a href="javascript:void(0)" class="text-white font-14" id="btnRujukanBaru">
                                <div class="card-footer text-center">
                                    <span>Pilih <i class="mdi mdi-arrow-right-bold-circle-outline"></i></span>
                                </div>
                            </a>
						  </div>
						</div>
						<div class="col-xl-5 col-md-6 mx-auto pl-0">
							<div class="card shadow text-white bg-warning">
							  <div class="card-body">
								<div class="row no-gutters align-items-center">
								  <div class="col">
									  <div class="h5 font-weight-bold text-uppercase mb-2">KONTROL ULANG</div>
									  <div class="p mb-0 font-13">UNTUK PASIEN KONTROL ULANG RSUP Dr. Mohammad Hoesin</div>
									</div>
								</div>
							  </div>
							  <a href="javascript:void(0)" class="text-white font-14" id="btnKontrolUlang">
                                <div class="card-footer text-center">
                                    <span>Pilih <i class="mdi mdi-arrow-right-bold-circle-outline"></i></span>
                                </div>
                            </a>
							</div>
						</div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 text-center">
                            <br>
                            <a href="{% url 'home' %}" class="btn btn-danger btn-round px-5 shadow"><i class="mdi mdi-arrow-left"></i> KEMBALI</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="footer">
        <marquee>
            Selamat Datang di RSUP Dr. Mohammad Hoesin, "Kesembuhan dan Kepuasan Anda Merupakan Kebahagiaan Kami"
        </marquee>
    </div>



    <!-- </div> -->
    <!-- end page-wrapper -->


    <!-- jQuery  -->
    <script src="{% static 'Amezia_v1.2.0/assets/js/jquery.min.js' %}"></script>
    <script src="{% static 'Amezia_v1.2.0/assets/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'Amezia_v1.2.0/assets/js/waves.min.js' %}"></script>
    <script src="{% static 'Amezia_v1.2.0/assets/js/jquery.slimscroll.min.js' %}"></script>

    <script src="{% static 'Amezia_v1.2.0/assets/plugins/select2/select2.min.js' %}"></script>

    <!--Plugins-->
    <script src="{% static 'Amezia_v1.2.0/assets/plugins/morris/morris.min.js' %}"></script>
    <script src="{% static 'Amezia_v1.2.0/assets/plugins/raphael/raphael-min.js' %}"></script>
    <script src="{% static 'Amezia_v1.2.0/assets/plugins/metro/MetroJs.min.js' %}"></script>
    <script src="{% static 'Amezia_v1.2.0/assets/plugins/jquery-knob/excanvas.js' %}"></script>
    <script src="{% static 'Amezia_v1.2.0/assets/plugins/jquery-knob/jquery.knob.min.js' %}"></script>

    <!-- Sweet-Alert  -->
    <script src="{% static 'Amezia_v1.2.0/assets/plugins/sweetalert2/dist/sweetalert2.all.min.js' %}"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script> -->

    <!-- App js -->
    <script src="{% static 'Amezia_v1.2.0/assets/js/app.js' %}"></script>

    <script>
        $(function(){  
            let noRujukan='';
            let poliRujukan='';
            $('#poli_tujuan').select2({
                placeholder: "Silahkan Pilih Poliklinik"
            });
            $(document).on("click","#btnRujukanBaru",function() {
                createRujukanBaru();
            });

            $(document).on("click","#btnLanjutRujukanBaru",function() {
                if($('#poli_tujuan').val() === '') {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Perhatian!',
                        text: 'Silahkan Pilih Poliklinik Tujuan.',
                        timer: 2500
                    })
                } else {
                    Swal.fire({
                        title: 'Apakah Data Sudah Benar?',
                        text: "Data akan diproses untuk selanjutnya mencetak SEP.",
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Ya, Proses',
                        cancelButtonText: 'Batal',
                    }).then((result) => {
                        if (result.value) {
                            Swal.fire(
                                'Proses pendaftaran berhasil!',
                                'Silahkan ambil cetakan SEP lalu ke Poli '+$('#poli_tujuan').select2('data')[0].text,
                                'success'
                            )
                        }
                    });
                }

            });

            $(document).on("click","#btnKembaliRujukanBaru",function() {
                noRujukan='';
                poliRujukan='';
                $('#modalKonfirmRujukan').modal('hide');
                createRujukanBaru();
            });

        });

        function createRujukanBaru() {
            Swal.fire({
                title: 'Masukkan No. Rujukan / No. BPJS',
                showClass: {
                    popup: 'animated fadeInDown faster'
                },
                hideClass: {
                    popup: 'animated fadeOutUp faster'
                },
                input: 'text',
                inputAttributes: {
                    autocapitalize: 'off'
                },
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Lanjutkan <i class="fa fa-arrow-right"></i>',
                cancelButtonText: 'Batal',
                showCancelButton: true,
                showLoaderOnConfirm: true,
                preConfirm: (nomor) => {
                    return fetch("{% url 'search_rujukan' %}", {
                        method: 'POST',
                        headers: {
                            'Content-Type':'application/x-www-form-urlencoded',
                            'X-CSRFToken': csrftoken
                        },
                        body: 'nomor='+nomor
                    }).then(response => {
                        if (!response.ok) {
                            Swal.showValidationMessage(
                                response.statusText
                            )
                        }
                        return response.json();
                    }).then(result => {
                        if (result.metaData.code === '200') {
                            noRujukan = result.response.rujukan.noKunjungan;
                            poliRujukan = result.response.rujukan.poliRujukan.nama;
                            $.ajax({
                                url: "{% url 'show_poli_bpjs' %}",                         
                                method: "POST",  
                                headers: {
                                    'Content-Type':'application/x-www-form-urlencoded',
                                    'X-CSRFToken': csrftoken
                                },
                                dataType: "JSON",
                                data: {
                                    "kode_poli" : result.response.rujukan.poliRujukan.kode
                                },
                                beforeSend:function() {
                                    $('#poli_tujuan').empty();
                                    $('#poli_tujuan').append($("<option />").val('').text('Silahkan Pilih Poliklinik'));
                                },
                                success: function(resultPoli) { 
                                    // if (resultPoli.metaData.code === '200') {  
                                    //     console.log(resultPoli)
                                    // } else {
                                    //     Swal.showValidationMessage(
                                    //         resultPoli.metaData.message
                                    //     )
                                    // }
                                    
                                    $.each(resultPoli.response, function() {
                                        $('#poli_tujuan').append($("<option />").val(this.id_poli).text(this.nm_poli));
                                    });
                                },
                                error:function(eventError, textStatus, errorThrown) {   
                                    Swal.showValidationMessage(
                                        formatErrorMessage(eventError, errorThrown)
                                    )
                                }
                            });
                            $('#no_rm').val(('0000000000'+result.response.rujukan.peserta.mr.noMR).substring(Math.min((""+result.response.rujukan.peserta.mr.noMR).length,10)));
                            $('#nm_pasien').val(result.response.rujukan.peserta.nama);
                            $('#tgl_lahir').val(result.response.rujukan.peserta.tglLahir);
                            if(result.response.rujukan.peserta.sex === 'L') {
                                $('#gender').val('Laki-Laki');
                            } else if(result.response.rujukan.peserta.sex === 'P') {
                                $('#gender').val('Perempuan');
                            } else {
                                $('#gender').val('');
                            }
                            $('#no_bpjs').val(result.response.rujukan.peserta.noKartu);
                            $('#no_telp').val(result.response.rujukan.peserta.mr.noTelepon);
                            $('#no_rujukan').val(noRujukan);
                            $('#perujuk').val(result.response.rujukan.provPerujuk.nama);
                            $('#tgl_rujukan').val(result.response.rujukan.tglKunjungan);
                            $('#poli_tujuan').val(result.response.rujukan.poliRujukan.nama + ' ( '+result.response.rujukan.poliRujukan.nama+' )');
                            $('#diagnosa').val(result.response.rujukan.diagnosa.nama);
                            $('#modalKonfirmRujukan').modal({backdrop: 'static', keyboard: false});
                            $('#modalKonfirmRujukan').modal('show');
                        } else {
                            Swal.showValidationMessage(
                                result.metaData.message
                            )
                        }
                    }).catch(error => {
                        Swal.showValidationMessage(
                            `Request failed: ${error}`
                        )
                    })
                },
                allowOutsideClick: () => !Swal.isLoading()
            })
        }

        function formatErrorMessage(jqXHR, exception) {
            if (jqXHR.status === 0) {
                return ('Not connected.\nPlease verify your network connection.');
            } else if (jqXHR.status == 404) {
                return ('The requested page not found.');
            }  else if (jqXHR.status == 401) {
                return ('Sorry!! You session has expired. Please login to continue access.');
            } else if (jqXHR.status == 500) {
                return ('Internal Server Error.');
            } else if (exception === 'parsererror') {
                return ('Requested JSON parse failed.');
            } else if (exception === 'timeout') {
                return ('Time out error.');
            } else if (exception === 'abort') {
                return ('Ajax request aborted.');
            } else {
                return ('Unknown error occured. Please try again.');
            }
        }
    </script>

    <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="konfirmRujukanModalLabel" aria-hidden="true" id="modalKonfirmRujukan">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header text-center modal-header-primary">
                    <h5 class="modal-title w-100 mt-0" id="konfirmRujukanModalLabel">Konfirmasi Data Rujukan</h5>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="field-1" class="control-label">No. Rekam Medis</label>
                                <input type="text" class="form-control" id="no_rm" disabled>
                            </div>
                            <div class="form-group">
                                <label for="field-1" class="control-label">Nama</label>
                                <input type="text" class="form-control" id="nm_pasien" disabled>
                            </div>
                            <div class="row">
                                <div class="col-md-7">
                                    <div class="form-group">
                                        <label for="field-1" class="control-label">Tanggal Lahir</label>
                                        <input type="text" class="form-control" id="tgl_lahir" disabled>
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <div class="form-group">
                                        <label for="field-2" class="control-label">Jenis Kelamin</label>
                                        <input type="text" class="form-control" id="gender" disabled>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="field-1" class="control-label">No. BPJS</label>
                                <input type="text" class="form-control" id="no_bpjs" disabled>
                            </div>
                            <div class="form-group">
                                <label for="field-1" class="control-label">No. Telp</label>
                                <input type="text" class="form-control" id="no_telp" disabled>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="field-2" class="control-label">No. Rujukan</label>
                                <input type="text" class="form-control" id="no_rujukan" disabled>
                            </div>
                            <div class="form-group">
                                <label for="field-2" class="control-label">Faskes Perujuk</label>
                                <input type="text" class="form-control" id="perujuk" disabled>
                            </div>
                            <div class="form-group">
                                <label for="field-2" class="control-label">Tanggal Rujukan</label>
                                <input type="text" class="form-control" id="tgl_rujukan" disabled>
                            </div>
                            <div class="form-group">
                                <label for="field-2" class="control-label">Poli Tujuan</label>
                                <select class="form-control mb-3" id="poli_tujuan" style="width: 100%; height:36px;">
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="field-2" class="control-label">Diagnosa</label>
                                <input type="text" class="form-control" id="diagnosa" disabled>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-warning" id="btnKembaliRujukanBaru"><i class="fa fa-arrow-left"></i> Kembali</button>
                    <button type="button" class="btn btn-info" id="btnLanjutRujukanBaru">Lanjutkan <i class="fa fa-arrow-right"></i></button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Batal <i class="fa fa-times-circle"></i></button>
                </div>
            </div>
        </div>
    </div>

</body>

</html>